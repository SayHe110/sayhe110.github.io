<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="LeiJian"><title>【外文翻译】使用 Laravel 时的一些小技巧 · LeiJian</title><meta name="description" content="译文地址第一次翻译文章，如有翻译不好的地方还请大家指出，大家也可以直接看原文。

01: 触发父级的时间戳如标题所示，在子模型更新时，可以触发父模型的时间戳。例如 Comment 属于 Post，有时更新子模型导致更新父模型时间戳非常有用。例如，当 Comment 模型被更新时，您要自动触发父级 P"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title><a href="/">LeiJian<p>PHP Engineer</p></a></h3></div></div><ul class="social-links"><li><a href="http://github.com/sayhe110"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>【外文翻译】使用 Laravel 时的一些小技巧</a></h3></div><div class="post-content"><blockquote>
<p><a href="https://meramustaqbil.com/2019/03/23/20-un-known-gems-of-laravel/" target="_blank" rel="noopener">译文地址</a><br>第一次翻译文章，如有翻译不好的地方还请大家指出，大家也可以直接看原文。</p>
</blockquote>
<h3 id="01-触发父级的时间戳"><a href="#01-触发父级的时间戳" class="headerlink" title="01: 触发父级的时间戳"></a>01: 触发父级的时间戳</h3><p>如标题所示，在子模型更新时，可以触发父模型的时间戳。例如 <code>Comment</code> 属于 <code>Post</code>，有时更新子模型导致更新父模型时间戳非常有用。例如，当 <code>Comment</code> 模型被更新时，您要自动触发父级 <code>Post</code> 模型的 <code>updated_at</code> 时间戳的更新。<code>Eloquent</code> 让它变得简单，只需添加一个包含子模型关系名称的 <code>touch</code> 属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace App;</span><br><span class="line">use Illuminate\Database\Eloquent\Model;</span><br><span class="line">class Comment extends Model</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 涉及到的所有关联关系。</span><br><span class="line">     *</span><br><span class="line">     * @var array</span><br><span class="line">     */</span><br><span class="line">    protected $touches = [&apos;post&apos;];</span><br><span class="line">    /**</span><br><span class="line">     * 获取评论所属的文章。</span><br><span class="line">     */</span><br><span class="line">    public function post()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;belongsTo(&apos;App\Post&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="02-预加载精确的列"><a href="#02-预加载精确的列" class="headerlink" title="02: 预加载精确的列"></a>02: 预加载精确的列</h3><p>在使用预加载时，可以从关系中获取指定的列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$users = App\Book::with(&apos;author:id,name&apos;)-&gt;get();</span><br></pre></td></tr></table></figure>

<h3 id="03-为单个请求验证用户身份"><a href="#03-为单个请求验证用户身份" class="headerlink" title="03: 为单个请求验证用户身份"></a>03: 为单个请求验证用户身份</h3><p>你可以使用 <code>Auth::once()</code> 来为单个请求验证用户的身份，此方法不会使用 <code>Cookie</code> 会话。这意味着此方法可能有助于构建无状态 <strong>API</strong> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (Auth::once($credentials)) &#123;</span><br><span class="line">    //</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="04-重定向到带有参数的控制器方法中"><a href="#04-重定向到带有参数的控制器方法中" class="headerlink" title="04: 重定向到带有参数的控制器方法中"></a>04: 重定向到带有参数的控制器方法中</h3><p>你不仅可以将 <code>redirect()</code> 方法用于用户特定的 URL 或者路由中，还可以用于控制器中带有参数的方法中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return redirect()-&gt;action(&apos;SomeController@method&apos;, [&apos;param&apos; =&gt; $value]);</span><br></pre></td></tr></table></figure>

<h3 id="05-如何使用-withDefault-避免在关系中出现的错误"><a href="#05-如何使用-withDefault-避免在关系中出现的错误" class="headerlink" title="05: 如何使用 withDefault() 避免在关系中出现的错误"></a>05: 如何使用 <code>withDefault()</code> 避免在关系中出现的错误</h3><p>当一个关系被调用时，如果它不存在，则会出现致命的错误，例如 <code>$post-&gt;user-&gt;name</code> ，可以使用 <code>withDefault()</code> 来避免。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/** 获取文章作者 */ </span><br><span class="line">public function user() </span><br><span class="line">&#123;     </span><br><span class="line">	return $this-&gt;belongsTo(&apos;App\User&apos;)-&gt;withDefault(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="06-在模版中两个平级的-loop-变量"><a href="#06-在模版中两个平级的-loop-变量" class="headerlink" title="06: 在模版中两个平级的 $loop 变量"></a>06: 在模版中两个平级的 <code>$loop</code> 变量</h3><p>在 <code>blade</code> 的 <code>foreach</code> 中，即使在两次循环中，依然可以通过使用 <code>$loop</code> 变量来获取父级变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@foreach ($users as $user)     </span><br><span class="line">	@foreach ($user-&gt;posts as $post)         </span><br><span class="line">		@if ($loop-&gt;parent-&gt;first)             </span><br><span class="line">			This is first iteration of the parent loop.         </span><br><span class="line">		@endif     </span><br><span class="line">	@endforeach </span><br><span class="line">@endforeach</span><br></pre></td></tr></table></figure>

<h3 id="07-修改查询结果"><a href="#07-修改查询结果" class="headerlink" title="07: 修改查询结果"></a>07: 修改查询结果</h3><p>在执行 <code>Eloqument</code> 查询后，你可以使用 <code>map()</code> 来修改行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$users = User::where(&apos;role_id&apos;, 1)-&gt;get()-&gt;map(function (User $user) &#123;</span><br><span class="line">    $user-&gt;some_column = some_function($user);</span><br><span class="line">    return $user;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="08-轻松的使用-dd"><a href="#08-轻松的使用-dd" class="headerlink" title="08: 轻松的使用 dd()"></a>08: 轻松的使用 <code>dd()</code></h3><p>在 <code>Eloqument</code> 的最后加上 <code>$test-&gt;dd()</code>，来代替 <code>dd($result)</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 优化前</span><br><span class="line">$users = User::where(&apos;name&apos;, &apos;Taylor&apos;)-&gt;get();</span><br><span class="line">dd($users);</span><br><span class="line">// 优化后</span><br><span class="line">$users = User::where(&apos;name&apos;, &apos;Taylor&apos;)-&gt;get()-&gt;dd();</span><br></pre></td></tr></table></figure>

<h3 id="09-Use-hasMany-to-saveMany"><a href="#09-Use-hasMany-to-saveMany" class="headerlink" title="09: Use hasMany to saveMany."></a>09: Use hasMany to saveMany.</h3><p>如果有 <code>hasMany()</code> 关联关系，和想要从父类对象中保存许多子类对象，可以使用 <code>saveMany()</code> 来达到你想要的效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$post = Post::find(1);</span><br><span class="line">$post-&gt;comments()-&gt;saveMany([</span><br><span class="line">    new Comment([&apos;message&apos; =&gt; &apos;First comment&apos;]),</span><br><span class="line">    new Comment([&apos;message&apos; =&gt; &apos;Second comment&apos;]),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="10-在-Model-all-中指定列"><a href="#10-在-Model-all-中指定列" class="headerlink" title="10: 在 Model::all() 中指定列"></a>10: 在 <code>Model::all()</code> 中指定列</h3><p>当你使用 <code>Eloqument</code> 的 <code>Model::all()</code> 时，你可以指定要返回的列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$users = User::all([&apos;id&apos;, &apos;name&apos;, &apos;email&apos;]);</span><br></pre></td></tr></table></figure>

<h3 id="11-Blade-中的-auth"><a href="#11-Blade-中的-auth" class="headerlink" title="11: Blade 中的 @auth"></a>11: <code>Blade</code> 中的 <code>@auth</code></h3><p>你可以使用 <code>@auth</code> 指令来代替 <code>if</code> 语句来检查用户是否经过身份验证。</p>
<h5 id="典型的方法："><a href="#典型的方法：" class="headerlink" title="典型的方法："></a>典型的方法：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@if(auth()-&gt;user())     // The user is authenticated. @endif</span><br></pre></td></tr></table></figure>

<h5 id="简短的方法："><a href="#简短的方法：" class="headerlink" title="简短的方法："></a>简短的方法：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@auth    </span><br><span class="line"> // The user is authenticated. </span><br><span class="line">@endauth</span><br></pre></td></tr></table></figure>

<h3 id="12-预览邮件而不发送"><a href="#12-预览邮件而不发送" class="headerlink" title="12: 预览邮件而不发送"></a>12: 预览邮件而不发送</h3><p>如果你使用 <strong>Mailables</strong> 来发送你的邮件，你可以预览它们而不发送出去。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(&apos;/mailable&apos;, function () &#123;</span><br><span class="line">    $invoice = App\Invoice::find(1);</span><br><span class="line">    return new App\Mail\InvoicePaid($invoice);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="13-hasMany-的特定检查"><a href="#13-hasMany-的特定检查" class="headerlink" title="13: hasMany 的特定检查"></a>13: <code>hasMany</code> 的特定检查</h3><p>在 <code>Eloquent</code> 的 <code>hasMany()</code> 关系中，你可以筛选出具有 n 个子记录数量的记录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Author -&gt; hasMany(Book::class) </span><br><span class="line">$authors = Author::has(&apos;books&apos;, &apos;&gt;&apos;, 5)-&gt;get();</span><br></pre></td></tr></table></figure>

<h3 id="14-恢复多个软删除"><a href="#14-恢复多个软删除" class="headerlink" title="14: 恢复多个软删除"></a>14: 恢复多个软删除</h3><p>如果记录使用了软删除，那么你就可以一次恢复多条软删除记录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Post::withTrashed()-&gt;where(&apos;author_id&apos;, 1)-&gt;restore();</span><br></pre></td></tr></table></figure>

<h3 id="15-带时区的迁移列"><a href="#15-带时区的迁移列" class="headerlink" title="15: 带时区的迁移列"></a>15: 带时区的迁移列</h3><p>迁移文件不仅有 <code>timestamps()</code> 时间戳，还有 <code>timestampsTz()</code> 带有时区的时间戳。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(&apos;employees&apos;, function (Blueprint $table) &#123;</span><br><span class="line">	$table-&gt;increments(&apos;id&apos;);</span><br><span class="line">	$table-&gt;string(&apos;name&apos;);</span><br><span class="line">    $table-&gt;string(&apos;email&apos;);</span><br><span class="line">    $table-&gt;timestampsTz();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="16-视图文件是否存在？"><a href="#16-视图文件是否存在？" class="headerlink" title="16: 视图文件是否存在？"></a>16: 视图文件是否存在？</h3><p>你知道还可以检查视图文件是否存在吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (view()-&gt;exists(&apos;custom.page&apos;)) &#123;</span><br><span class="line">	// Load the view</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-组中的路由组"><a href="#17-组中的路由组" class="headerlink" title="17: 组中的路由组"></a>17: 组中的路由组</h3><p>在路由文件中，你可以为一个路由组创造一个组，还可以为其指定特定的中间件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::group([&apos;prefix&apos; =&gt; &apos;account&apos;, &apos;as&apos; =&gt; &apos;account.&apos;], function() &#123;</span><br><span class="line">    Route::get(&apos;login&apos;, &apos;AccountController@login&apos;);     </span><br><span class="line">    Route::get(&apos;register&apos;, &apos;AccountController@register&apos;);</span><br><span class="line">    Route::group([&apos;middleware&apos; =&gt; &apos;auth&apos;], function() &#123;         </span><br><span class="line">        Route::get(&apos;edit&apos;, &apos;AccountController@edit&apos;);     </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="18-Eloquent-中的日期时间方法"><a href="#18-Eloquent-中的日期时间方法" class="headerlink" title="18: Eloquent 中的日期时间方法"></a>18: <code>Eloquent</code> 中的日期时间方法</h3><p><code>whereDay()</code> , <code>whereMonth()</code> , <code>whereYear()</code> , <code>whereDate()</code> , <code>whereTime()</code> 这些方法皆为 <code>Eloquent</code> 中检查日期的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$products = Product::whereDate(&apos;created_at&apos;, &apos;2018-01-31&apos;)-&gt;get(); </span><br><span class="line">$products = Product::whereMonth(&apos;created_at&apos;, &apos;12&apos;)-&gt;get(); </span><br><span class="line">$products = Product::whereDay(&apos;created_at&apos;, &apos;31&apos;)-&gt;get(); </span><br><span class="line">$products = Product::whereYear(&apos;created_at&apos;, date(&apos;Y&apos;))-&gt;get(); </span><br><span class="line">$products = Product::whereTime(&apos;created_at&apos;, &apos;=&apos;, &apos;14:13:58&apos;)-&gt;get();</span><br></pre></td></tr></table></figure>

<h3 id="19-在-Eloquent-关系中使用-orderBy"><a href="#19-在-Eloquent-关系中使用-orderBy" class="headerlink" title="19: 在 Eloquent 关系中使用 orderBy()"></a>19: 在 <code>Eloquent</code> 关系中使用 <code>orderBy()</code></h3><p>你可以在 <code>Eloquent</code> 关系中直接指定 <code>orderBy()</code> 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public function products()</span><br><span class="line">&#123;</span><br><span class="line">    return $this-&gt;hasMany(Product::class);</span><br><span class="line">&#125;</span><br><span class="line">public function productsByName()</span><br><span class="line">&#123;</span><br><span class="line">    return $this-&gt;hasMany(Product::class)-&gt;orderBy(&apos;name&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="20-无符号整型"><a href="#20-无符号整型" class="headerlink" title="20: 无符号整型"></a>20: 无符号整型</h3><p>对于迁移的外键，不要使用 <code>integer()</code> , 而是使用 <code>unsignedInteger()</code> 或者是 <code>integer()-&gt;unsigned()</code> ，否则将会出现一系列的错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(&apos;employees&apos;, function (Blueprint $table) &#123;     </span><br><span class="line">    $table-&gt;unsignedInteger(&apos;company_id&apos;);     </span><br><span class="line">    $table-&gt;foreign(&apos;company_id&apos;)-&gt;references(&apos;id&apos;)-&gt;on(&apos;companies&apos;);     </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-04-04</span><i class="fa fa-tag"></i></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://blog.sayhe110.cn/2019/04/04/【外文翻译】使用-Laravel-时的一些小技巧/,LeiJian,【外文翻译】使用 Laravel 时的一些小技巧,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/06/08/使用-Hexo-GitHub-构建个人博客/" title="使用 Hexo + GitHub 搭建个人博客">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/03/24/善于使用搜索引擎不好吗/" title="善于使用搜索引擎不好吗">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>